# pgAnalytics Helm Chart - Enterprise Values
# Override default values for enterprise deployment with advanced features

global:
  environment: production
  domain: pganalytics.enterprise.com
  tls:
    enabled: true
    issuer: "letsencrypt-prod"

backend:
  replicaCount: 5

  service:
    type: ClusterIP
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: nlb

  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/rate-limit: "1000"
      nginx.ingress.kubernetes.io/proxy-body-size: "500m"
      nginx.ingress.kubernetes.io/proxy-connect-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    hosts:
      - host: api.pganalytics.enterprise.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: pganalytics-enterprise-api-tls
        hosts:
          - api.pganalytics.enterprise.com

  resources:
    limits:
      cpu: 4000m
      memory: 2Gi
    requests:
      cpu: 2000m
      memory: 1Gi

  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 75

collector:
  mode: daemonset

  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 500m
      memory: 256Mi

postgresql:
  enabled: false  # Use managed database (AWS RDS, GCP Cloud SQL, etc.)

  # Example for external PostgreSQL configuration
  externalPostgresql:
    host: "pganalytics-prod.example.com"
    port: 5432
    database: "pganalytics"
    username: "pganalytics"
    ssl: true
    sslMode: "require"

redis:
  replicaCount: 3

  persistence:
    enabled: true
    storageClass: fast-ssd
    size: 50Gi

  resources:
    limits:
      cpu: 2000m
      memory: 1Gi
    requests:
      cpu: 1000m
      memory: 512Mi

  # Redis Sentinel configuration for HA
  sentinel:
    enabled: true
    quorum: 2

grafana:
  replicaCount: 2

  persistence:
    enabled: true
    storageClass: fast-ssd
    size: 50Gi

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  env:
    - name: GF_USERS_ALLOW_SIGN_UP
      value: "false"
    - name: GF_AUTH_LDAP_ENABLED
      value: "true"
    - name: GF_AUTH_LDAP_CONFIG
      value: "/etc/grafana/ldap.toml"

networkPolicy:
  enabled: true

podDisruptionBudget:
  enabled: true
  minAvailable: 2

# High Availability
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - pganalytics
        topologyKey: kubernetes.io/hostname
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - pganalytics
        topologyKey: topology.kubernetes.io/zone

# Node affinity for preferred node types
nodeSelector:
  workload: analytics

tolerations:
  - key: workload
    operator: Equal
    value: analytics
    effect: NoSchedule

priorityClassName: high-priority

features:
  anomalyDetection: true
  tokenBlacklist: true
  corsWhitelisting: true
  mlService: true
  multiRegion: true
  advancedAuth: true
  ldapSync: true
  samlIntegration: true
  encryptionAtRest: true
  auditLogging: true
  backupDR: true

# Encryption configuration
encryption:
  enabled: true
  keyProvider: "vault"  # or aws-kms, gcp-kms, azure-keyvault
  vaultAddress: "https://vault.enterprise.com"
  vaultAuthMethod: "kubernetes"
  vaultSecretsPath: "secret/pganalytics"

# Backup configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # 2 AM daily
  retention: 30  # days
  destination: "s3://pganalytics-backups"
  encryption: true
  verification: true

# Monitoring and logging
monitoring:
  enabled: true
  prometheus:
    enabled: true
    interval: 15s
  datadog:
    enabled: true
    apiKey: "${DATADOG_API_KEY}"
  newrelic:
    enabled: true
    licenseKey: "${NEWRELIC_LICENSE_KEY}"

logging:
  enabled: true
  level: info
  format: json
  outputs:
    - stdout
    - cloudwatch  # AWS CloudWatch
    - stackdriver  # GCP Stackdriver
    - elasticsearch  # ELK Stack

# LDAP Integration
ldap:
  enabled: true
  servers:
    - url: "ldap://ldap.enterprise.com:389"
      bindDN: "cn=admin,dc=enterprise,dc=com"
      baseDN: "dc=enterprise,dc=com"
      userSearchFilter: "(uid={0})"
      groupSearchFilter: "(memberUid={0})"
      useSSL: true
      startTLS: false
      timeout: 30

# SAML Integration
saml:
  enabled: true
  entityID: "pganalytics.enterprise.com"
  ssoURL: "https://idp.enterprise.com/sso"
  certificatePath: "/etc/pganalytics/saml-cert.pem"
  privateKeyPath: "/etc/pganalytics/saml-key.pem"

# OAuth configuration
oauth:
  enabled: true
  providers:
    - name: google
      clientID: "${GOOGLE_OAUTH_CLIENT_ID}"
      clientSecret: "${GOOGLE_OAUTH_CLIENT_SECRET}"
    - name: github
      clientID: "${GITHUB_OAUTH_CLIENT_ID}"
      clientSecret: "${GITHUB_OAUTH_CLIENT_SECRET}"
    - name: okta
      clientID: "${OKTA_CLIENT_ID}"
      clientSecret: "${OKTA_CLIENT_SECRET}"
      authorizationURL: "https://okta.enterprise.com/oauth2/v1/authorize"
      tokenURL: "https://okta.enterprise.com/oauth2/v1/token"

# Multi-region configuration
multiRegion:
  enabled: true
  regions:
    - name: us-east-1
      primary: true
    - name: eu-west-1
      primary: false
    - name: ap-southeast-1
      primary: false

secrets:
  create: false
  # Use external secret management (Vault, AWS Secrets Manager, etc.)
  externalSecret:
    enabled: true
    backend: vault  # or aws-secrets-manager, gcp-secret-manager
    vaultAddress: "https://vault.enterprise.com"
    path: "secret/pganalytics/prod"
